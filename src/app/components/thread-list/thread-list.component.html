<div class="thread-list-page">
  <div class="thread-list-layout" style="position:relative;">
    <!-- Sidebar -->
    <nav class="sidebar">
      <button class="sidebar-btn" (click)="goHome()">Home</button>
      <button class="sidebar-btn" (click)="onQuestionsClick()">Questions</button>
      <button class="sidebar-btn">Replies</button>
    </nav>

    <!-- Tag Modal appears next to sidebar -->
    <app-tag-modal
      *ngIf="showTagModal"
      [tags]="allTags"
      (selectTag)="onTagSelected($event)"
      (close)="showTagModal = false">
    </app-tag-modal>

    <!-- Main Thread List Content -->
    <div class="thread-list-main">
      <!-- Search + Filter Row -->
      <div class="filter-search-container">
        <!-- Search Bar -->
        <input
          type="text"
          [(ngModel)]="searchTerm"
          placeholder="Search threads..."
          class="search-bar"
        />

        <!-- Filter Button + Dropdown Container -->
        <div class="filter-container">
          <button class="filter-btn" (click)="toggleFilterDropdown()">Filter</button>

          <!-- Dropdown appears directly under the button -->
          <div #filterDropdown class="filter-dropdown" *ngIf="showFilterDropdown">
            <label *ngFor="let tag of allTags" class="tag-checkbox">
              <input
                type="checkbox"
                [value]="tag.name"
                (change)="toggleTagFilter(tag.name, $event)"
              />
              {{ tag.name }}
            </label>
          </div>
        </div>
      </div>

      <!-- Thread List -->
      <div class="thread-list-container" [class.blurred]="selectedThreadId !== null">
        <!-- Blurred background with all thread cards except the selected one -->
        <app-thread-card
          *ngFor="let thread of filteredThreads"
          [thread]="thread"
          [selectedThreadId]="selectedThreadId"
          (selectThread)="onSelectThread($event)">
        </app-thread-card>
      </div>

      <!-- Modal-like highlighted selected thread card -->
      <ng-container *ngIf="selectedThreadId !== null && selectedThread">
        <div class="thread-modal-overlay" (click)="selectedThreadId = null"></div>
        <div class="thread-modal">
          <app-thread-card
            [thread]="selectedThread"
            [selectedThreadId]="selectedThreadId"
            (selectThread)="onSelectThread($event)">
          </app-thread-card>
        </div>
      </ng-container>
    </div>
  </div>
</div>

<!-- Ask Question Button -->
<button class="ask-question-btn" (click)="openThreadCreate()">Ask Question</button>

<!-- Modal overlay and modal content -->
<div class="modal-overlay" *ngIf="showThreadCreateModal" (click)="closeThreadCreate()"></div>
<div class="modal" *ngIf="showThreadCreateModal">
  <app-thread-create
    [author]="loggedInUsername"
    (created)="onThreadCreated()">
  </app-thread-create>
</div>



<!-- User Register Modal -->
<div class="modal-overlay" *ngIf="showUserRegisterModal" (click)="closeUserRegisterModal()"></div>
<div class="modal" *ngIf="showUserRegisterModal">
  <app-user-register (registered)="closeUserRegisterModal(); openThreadCreate()"></app-user-register>
</div>
